<main>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <div class="entity-add">
    <form id="addRequestForm">
      <label for="clientName">Имя клиента:</label>
      <label>
        <input id="clientNameInput" type="text" name="clientName">
      </label>
      <label for="contactInfo">Контактные данные:</label>
      <label>
        <input id="contactInfoInput" type="text" name="contactInfo" >
      </label>
      <label for="serviceRequested">Запрашиваемая услуга:</label>
      <select id="serviceRequested" name="serviceRequested">
        <option value="service1">Консультирование сельхозпроизводителей</option>
        <option value="service2">Споры с таможней</option>
        <option value="service3">Трудовые споры</option>
        <option value="service4">Контракты</option>
        <option value="service5">Локализация бизнеса</option>
      </select>
      <button type="submit">Создать</button>
    </form>
  </div>
  <script>
    document.getElementById('addRequestForm').addEventListener('submit', async (e) =>{
      e.preventDefault();

      const clientName = document.getElementById('clientNameInput').value;
      const contactInfo = document.getElementById('contactInfoInput').value;
      const serviceRequested = document.getElementById('serviceRequested').value;

      const data = { clientName, contactInfo, serviceRequested};


      fetch(`http://localhost:8082/request-add`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
        .then(response => response.json())
        .then(data => {

          console.log('Success:', data);
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    });
  </script>



  <script>
    toastr.options = { positionClass: 'toast-top-right',  timeout: 5000  };

    function setupEventSource() {
      const eventSource = new EventSource('http://localhost:8082/request-events');

      // Обработчик для события, которое приходит от сервера
      eventSource.onmessage = (event) => {

        try {
          const data = JSON.parse(event.data);
          if (data.message) {
            toastr.info(data.message);
          }
        } catch (e) {
          console.error('SSE parse error:', e);
        }
      };

      // Обработчик для ошибок SSE
      eventSource.onerror = (e) => {
        console.error('SSE error:', e);
        eventSource.close();
        setTimeout(setupEventSource, 2000);
      };
    }
    document.addEventListener('DOMContentLoaded', setupEventSource)
  </script>
</main>